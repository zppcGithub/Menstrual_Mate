好的，我们来将这份文档升级一下，加入更丰富的功能、更具体的技术实现细节，并重点突出 UI/UX 设计，使其更具吸引力和实用性。

### **项目名称：经期伴侣 (Menstrual Mate) - 高级版**

---

### **1. 需求文档 (Requirements Document) - V2.0**

#### **1.1. 项目概述**

“经期伴侣”是一款功能强大且设计精美的本地化生理周期跟踪软件。它不仅能帮助用户记录和预测生理期，还能通过多维度的数据图表和科学的周期阶段（如卵泡期、黄体期）分析，让用户更深入地了解自己的身体节律。软件前端将采用现代化的响应式设计，提供优雅、女性化的视觉体验。后端采用稳定高效的 Spring Boot + MySQL 技术栈，确保数据的可靠存储和快速处理。

#### **1.2. 用户画像**

*   **核心用户**：注重生活品质、希望通过数据化方式精细管理个人健康的女性。
*   **扩展用户**：备孕或希望避孕的女性，需要精确了解排卵期和安全期。
*   **共同特征**：对应用的 UI 设计有较高要求，重视数据隐私和安全性。

#### **1.3. 功能需求 (细化)**

| **模块** | **功能点** | **详细描述** | **优先级** |
| :--- | :--- | :--- | :--- |
| **核心记录** | **周期标记** | 用户可在日历上通过点击和拖拽，方便地标记经期的开始和结束日期。 | 高 |
| | **流量记录** | 用户可以记录每日的经血流量（如：点滴、少量、中等、大量）。 | 高 |
| | **多维度症状记录** | 提供丰富的标签库记录症状（如：腹痛、乳房胀痛、头痛）、情绪（如：愉悦、易怒、平静）和活动（如：运动、同房）。支持用户自定义标签。 | 高 |
| **智能分析与预测** | **周期阶段计算** | 自动计算并显示四个主要周期阶段：月经期、卵泡期、排卵期、黄体期。 | 高 |
| | **智能预测** | 基于最近 3-6 个周期的历史数据，通过加权平均算法预测下一次经期、排卵日和各个周期的起止时间。 | 高 |
| | **温馨提示** | 根据用户所处的不同周期阶段，推送相应的健康、护肤、饮食和运动建议。例如，在黄体期提示可能出现的情绪波动和皮肤问题。 | 高 |
| **数据可视化** | **日历视图** | - **直观展示**: 日历上用不同颜色和图案清晰地展示经期、预测经期、排卵日、排卵期和黄体期。<br>- **信息悬浮**: 鼠标悬停在特定日期上时，显示当天的记录详情（流量、症状、情绪等）。 | 高 |
| | **图表分析中心** | - **周期长度趋势**: 通过折线图展示历史周期长度的变化，帮助用户观察周期是否规律。<br>- **经期长度分析**: 通过柱状图展示每次经期的持续天数。<br>- **症状频率统计**: 以词云或条形图的形式，展示在不同周期阶段最常出现的症状。<br>- **周期对比视图**: 允许用户选择任意两个周期进行详细的数据对比。 | 高 |
| **用户体验** | **个性化主题** | 提供多种色彩柔和、设计优雅的主题供用户选择（如：樱花粉、薄荷绿、星空紫）。 | 中 |
| | **数据备份与恢复** | 支持将本地 MySQL 数据库备份为加密的 `.sql` 文件，并能从备份文件中恢复数据，防止数据丢失。 | 中 |
| | **密码保护** | 用户可以为应用设置启动密码，保护个人隐私。 | 中 |

---

### **2. 设计文档 (Design Document) - V2.0**

#### **2.1. UI/UX 设计理念**

*   **色彩与情感**: 采用低饱和度、柔和的色彩体系，如莫兰迪色系、马卡龙色系，营造温暖、舒适、安心的视觉感受。主色调可随用户选择的主题而改变。
*   **字体与排版**: 选择清晰易读且具有亲和力的无衬线字体（如：思源黑体、苹方）。通过合理的字号、行距和间距，构建富有呼吸感的界面布局。
*   **图标与插画**: 设计一套风格统一、简洁明了的扁平化或微渐变图标。在关键页面（如空状态、引导页）使用原创的女性主题插画，提升产品的艺术感和情感连接。
*   **动效设计**: 添加平滑、自然的微动效（如页面切换、按钮点击），提升操作的流畅度和愉悦感，但避免过度动画导致分散注意力。

**UI 示例概念**:

*   **日历页**: 以干净的月视图为主体，经期用柔和的粉色条带覆盖，排卵日用爱心或水滴图标标记，黄体期用淡黄色背景高亮。日期数字下方用不同颜色的小点表示当天记录了哪些类型的事件（症状、流量等）。
*   **图表页**: 图表采用与主题色一致的配色方案，线条平滑，信息点清晰。每个图表都配有简明的标题和单位说明，让数据一目了然。

#### **2.2. 技术栈与架构**

*   **前端**: Vue.js 3 或 React 18。
    *   **UI 库**: Element Plus 或 Ant Design，它们提供丰富且设计精良的组件，便于快速开发。
    *   **图表库**: ECharts 或 Chart.js，功能强大，可以轻松实现各类定制化的统计图表。
    *   **响应式方案**: CSS Flexbox + Grid 结合 UI 库的响应式栅格系统。
*   **后端**: Java 17 + Spring Boot 3.x。
    *   **构建工具**: Maven。
    *   **核心依赖**: `spring-boot-starter-web`, `spring-boot-starter-data-jpa`, `mysql-connector-j`。
*   **数据库**: MySQL 8.0。
*   **部署**: 由于是本地应用，可以通过 Electron 将整个 Web 应用（前端+后端Java服务）打包成一个跨平台的桌面应用程序（.exe, .dmg），实现开箱即用。Java 后端在应用启动时自动运行，MySQL 可以使用嵌入式模式或引导用户进行本地安装。

#### **2.3. 系统架构**

```mermaid
graph TD
    subgraph "客户端 (Electron / 浏览器)"
        A[前端 UI (Vue.js/React)]
        B[图表 (ECharts)]
        C[状态管理 (Pinia/Redux)]
    end

    A & B & C -->|HTTP/RESTful API| D[后端 (Spring Boot)]

    subgraph "后端服务"
        D --> E{Controller 层}
        E --> F{Service 层 (业务逻辑)}
        F --> G{Repository 层 (JPA)}
    end

    subgraph "数据存储"
        G --> H[(本地 MySQL 数据库)]
    end

    F -- 计算/预测 --> I{周期分析引擎}
    F -- 生成提示 --> J{健康提示模块}

```

#### **2.4. 后端设计 (细化)**

*   **API 设计 (RESTful)**:

| **HTTP方法** | **URI** | **功能描述** |
| :--- | :--- | :--- |
| `POST` | `/api/cycles` | 记录一次完整的经期（开始和结束日期）。 |
| `GET` | `/api/calendar-view` | 获取指定月份的日历视图数据（包含周期标记、预测等）。 |
| `POST` | `/api/daily-records` | 新增或更新某一日的详细记录（流量、症状、情绪等）。 |
| `GET` | `/api/daily-records/{date}` | 获取某一日的详细记录。 |
| `GET` | `/api/analysis/trends` | 获取用于图表分析的数据（周期/经期长度趋势）。 |
| `GET` | `/api/analysis/symptom-frequency` | 获取症状频率统计数据。 |
| `GET` | `/api/tips/{date}` | 获取指定日期的健康温馨提示。 |

*   **核心算法 - 周期阶段计算**:
    1.  **数据准备**: 获取用户最近6个完整周期（从一次月经开始到下一次月经开始）的数据。计算平均周期长度 `AvgCycleLength`。
    2.  **月经期 (Menstrual Phase)**: 用户手动标记的 `start_date` 到 `end_date`。
    3.  **卵泡期 (Follicular Phase)**: 从 `start_date` 开始，到排卵日结束。整个周期除了黄体期都是卵泡期。
    4.  **排卵期 (Ovulation)**:
        *   **预测排卵日**: `下次月经预测日` - 14 天。这是一个普遍的估算值。
        *   **排卵期范围**: `排卵日` 前的4-5天和排卵日当天。
    5.  **黄体期 (Luteal Phase)**: 从 `排卵日` 后一天开始，到本次月经开始前结束。通常持续 12-16 天。
    6.  **温馨提示逻辑**: 在 Service 层建立一个规则引擎或简单的 `Map`，将周期阶段与提示内容关联起来。当用户请求某日提示时，先判断该日属于哪个阶段，然后返回对应的提示。

#### **2.5. 数据库设计 (升级)**

*   **`cycle_records` 表 (周期记录表)**:
| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT (PK) | 唯一ID |
| `user_id` | BIGINT (FK) | 用户ID (为未来多用户扩展预留) |
| `start_date` | DATE | 经期开始日期 |
| `end_date` | DATE | 经期结束日期 |
| `cycle_length` | INT | 本次周期的总长度（天） |

*   **`daily_records` 表 (每日详情记录表)**:
| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT (PK) | 唯一ID |
| `record_date` | DATE (Unique) | 记录日期 |
| `menstrual_flow` | VARCHAR(20) | 经血流量 (e.g., 'LIGHT', 'MEDIUM', 'HEAVY') |
| `notes` | TEXT | 文字备注 |

*   **`symptom_records` 表 (症状关联表)**: (多对多关系)
| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `daily_record_id` | BIGINT (FK) | 关联到 `daily_records` 的ID |
| `symptom_id` | BIGINT (FK) | 关联到 `symptoms` 的ID |

*   **`symptoms` 表 (症状标签字典表)**:
| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT (PK) | 唯一ID |
| `name` | VARCHAR(50) | 症状名称 (如: '腹痛', '愉悦') |
| `type` | VARCHAR(20) | 标签类型 (如: 'SYMPTOM', 'MOOD', 'ACTIVITY') |
| `is_custom` | BOOLEAN | 是否为用户自定义 |

这份升级后的文档提供了更全面的功能规划、更现代化的技术选型和更具体的设计思路，希望能为您的开发工作提供一个坚实的基础。